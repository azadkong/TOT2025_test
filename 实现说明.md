
# 项目主要实现说明

## 1. 项目概述
本项目包含两个主要解析器：
- **ExpressParser**：解析 EXPRESS 格式的实体定义，提取实体名称、父类关系及属性信息。
- **GfcParser**：解析 GFC 文件，统计类实例数量并提取实例引用信息。

## 2. 核心功能实现

### 2.1 ExpressParser
- **文件读取**：使用 `QTextStream`，Qt6 采用 `QStringConverter::Utf8` 设置编码，Qt5 退回 `setCodec("UTF-8")`。
- **解析 ENTITY**：通过正则匹配 `ENTITY` 开头，提取实体名。
- **解析父类关系**：支持 `SUBTYPE OF` 跨行、带注释、多父类解析。
- **属性解析**：去除属性末尾分号和多余空格，统一格式为 `name : TYPE`。
- **EOF 宽松处理**：若文件末尾缺失 `END_ENTITY;`，自动提交当前解析实体。
- **构建子类映射**：`buildChildrenMap()` 收集所有被引用为父类的实体名作为 key，子类挂到每个父类下。

### 2.2 GfcParser
- **实例解析**：匹配 `#index = CLASSNAME(...)` 格式，提取实例编号和类名。
- **跨行与空白处理**：支持实例定义跨行及多余空格。
- **无效行过滤**：忽略不符合实例格式的行。
- **计数统计**：记录每个类的实例数量。

## 3. 测试实现
- 使用 GoogleTest 框架，包含对 ExpressParser 与 GfcParser 的单元测试。
- 测试覆盖了：
  - 基本解析功能
  - 父类-子类映射
  - 属性末尾符号裁剪
  - GFC 实例解析与计数
  - 空白与无效行处理
  - 实例索引解析的边界情况

## 4. 关键优化
- **增强健壮性**：针对跨行、注释、多父类场景增加解析容错。
- **编码兼容**：兼容 Qt5 与 Qt6 的 UTF-8 编码方式。
- **路径限制规避**：CMake FetchContent 使用短路径目录避免 Windows MAX_PATH 限制。
- **ZIP 优先获取 gtest**：减少网络限制对构建的影响。

## 5. 构建与运行
```bash
cmake -S . -B build -G "Ninja"   -DCMAKE_BUILD_TYPE=Debug   -DCMAKE_PREFIX_PATH="D:/software/qt69/6.9.1/msvc2022_64"   -DGTEST_FETCH=ON
cmake --build build -j
ctest --test-dir build --output-on-failure
```
